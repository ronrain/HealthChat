<%- include('../partials/html-head') %>
<link rel="stylesheet" href="/stylesheets/discussions/show.css">
<%- include('../partials/nav') %>

<section>
  <img src="<%= discussion.avatar %>" alt="a picture of the discussion post's author">
  <p>Discussion Posted by <%= discussion.author.name %></p>
  <h1>Health Concern: <%= discussion.topic %></h1>
  <h2>Comments about the Health Concern: <%= discussion.content %></h2>
  <h2>My symptoms are: <%= discussion.symptom %></h2>
  <% if (discussion.author.equals(user?.profile._id)) { %>
    <a id="discussion-show" href="/discussions/<%= discussion._id %>/edit">
      <button class="btn">Edit this Discussion</button>
    </a>
    <form id="discussion-show" action="/discussions/<%= discussion._id %>?_method=DELETE" method="POST">
      <button class="btn" type="submit">Delete this Discussion</button>
    </form>
  <% } %>
  <h2>Comments:</h2>
  <ul>
    <% discussion.replies?.forEach(reply => { %>
      <li> 
        <a href="discussions/<%= discussion._id %>/replies/<%= reply._id %>"></a> <%= reply.comment %> - 
        <%= reply.isDoctor ? 'Medical Professional' : 'Non-Medical Professional' %> - <%=  reply.author %>
        <% if (reply.author?._id.equals(user?.profile._id)) { %>
          <form action="/discussions/<%= discussion._id %>/replies/<%= reply._id %>?_method=DELETE" method="POST" class="inline">
            <button class="btn" type="submit">Delete Comment</button>
          </form>
          <form action="/discussions/<%= discussion._id %>/replies/<%= reply._id %>/edit">
            <button class="btn">Edit Comment</button>
          </form>
          </a>
        <% } %>
      </li>
    <% }) %>
  </ul>
  <h2>Add a Comment:</h2>
  <% if (user) { %>
    <form action="/discussions/<%= discussion._id %>/replies" method="POST">
        <textarea name="comment"></textarea><br>
        <input type="checkbox"> Check the Box if you are a medical professional
        <button>Add Comment</button>
    </form>
  <% } else { %>
    <p>You need to log in to add a reply.</p>
  <% } %>
</section>


<%- include('../partials/footer') %>
